<!doctype html>
<html lang="en">
<head>

        <meta charset="utf-8" />
        <title>Two Step Verification | Course Registration</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- App favicon -->
        <link rel="shortcut icon" href="./static/images/favicon.ico">

        <!-- preloader css -->
        <link rel="stylesheet" href="./static/css/preloader.min.css" type="text/css" />

        <!-- Bootstrap Css -->
        <link href="./static/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
        <!-- Icons Css -->
        <link href="./static/css/icons.min.css" rel="stylesheet" type="text/css" />
        <!-- App Css-->
        <link href="./static/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />

    </head>

    <body>

    <!-- <body data-layout="horizontal"> -->
        <div class="auth-page">
            <div class="container-fluid p-0">
                <div class="row g-0">
                    <div class="col-xxl-4 col-lg-6 col-md-6 mx-auto">
                        <div class="auth-full-page-content d-flex p-sm-5 p-4">
                            <div class="w-100">
                                <div class="d-flex flex-column h-100">
                                    <div class="mb-4 mb-md-5 text-center">
                                        <a href="#" class="d-block auth-logo">
                                            <img src="./staticimages/logo-sm.svg" alt="" height="28"> <span class="logo-txt">Course Registation Portal</span>
                                        </a>
                                    </div>
                                    <div class="auth-content my-auto">
                                        <div class="text-center">

                                            <div class="avatar-md mx-auto">
                                                <div class="avatar-title rounded-circle bg-light">
                                                    <i class="bx bxs-envelope h2 mb-0 text-primary"></i>
                                                </div>
                                            </div>
                                            <div class="p-2 mt-3">
                    
                                                <h4>Verify your email</h4>
                                                <p class="mb-4">Please enter the 4 digit code sent to <span id="email" class="fw-bold">{{email}}</span></p>
                                                <!-- alert -->
                                                <div class="alert alert-secondary alert-dismissible fade show" role="alert" id="message-parent" style="display: none;">
                                                    <span id="message"></span>
                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                                </div>
                                                <form action="/verification" method="post">
                                                    <!-- <div class="mb-3">
                                                        <label class="form-label">OTP</label>
                                                        <input type="password" class="form-control" id="otp" placeholder="" required maxlength="6" minlength="6">
                                                        <small>OTP will expire in 5 mins</small>
                                                    </div> -->
                                                    <div class="row">
                                                        <div class="col-3">
                                                            <div class="mb-3">
                                                                <label for="digit1-input" class="visually-hidden">Dight 1</label>
                                                                <input name="digit1" type="text" class="form-control form-control-lg text-center" onkeyup="moveToNext(this, 2)" maxlength="1" id="digit1-input">
                                                            </div>
                                                        </div>
                    
                                                        <div class="col-3">
                                                            <div class="mb-3">
                                                                <label for="digit2-input" class="visually-hidden">Dight 2</label>
                                                                <input name="digit2" type="text" class="form-control form-control-lg text-center" onkeyup="moveToNext(this, 3)" maxlength="1" id="digit2-input">
                                                            </div>
                                                        </div>
                    
                                                        <div class="col-3">
                                                            <div class="mb-3">
                                                                <label for="digit3-input" class="visually-hidden">Dight 3</label>
                                                                <input name="digit3" type="text" class="form-control form-control-lg text-center" onkeyup="moveToNext(this, 4)" maxlength="1" id="digit3-input">
                                                            </div>
                                                        </div>
                    
                                                        <div class="col-3">
                                                            <div class="mb-3">
                                                                <label for="digit4-input" class="visually-hidden">Dight 4</label>
                                                                <input name="digit4" type="text" class="form-control form-control-lg text-center" onkeyup="moveToNext(this, 5)" maxlength="1" id="digit4-input">
                                                            </div>
                                                        </div>
                                                        <small>OTP will expire in 5 mins</small>
                                                    </div>

                                                    <div class="mt-4">
                                                        <button class="btn btn-primary w-100 waves-effect waves-light" type="submit" id="submit">Confirm</button>
                                                    </div>
                                                </form>
                    
                                                
                                            </div>
                    
                                        </div>

                                        <div class="mt-2 text-center">
                                            <p class="text-muted mb-0">Didn't receive an email ? <a href="resend-otp"
                                                class="text-primary fw-semibold"> Resend </a> </p>
                                        </div>
                                    </div>
                                    <div class="mt-4 mt-md-5 text-center">
                                        <p class="mb-0">Â© <script>document.write(new Date().getFullYear());</script>Course Registation</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end auth full page content -->
                    </div>
                    <!-- end col -->
                    <!-- <div class="col-xxl-9 col-lg-8 col-md-7">
                        <div class="auth-bg pt-md-5 p-4 d-flex">
                            <div class="bg-overlay bg-primary"></div>
                            <ul class="bg-bubbles">
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                                <li></li>
                            </ul> -->
                            <!-- end bubble effect -->
                            <!-- <div class="row justify-content-center align-items-center">
                                <div class="col-xl-7">
                                    <div class="p-0 p-sm-4 px-xl-0"> -->
                                        
                                        <!-- end review carousel -->
                                    <!-- </div>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <!-- end col -->
                </div>
                <!-- end row -->
            </div>
            <!-- end container fluid -->
        </div>


        <!-- JAVASCRIPT -->
        <script src="./static/libs/jquery/jquery.min.js"></script>
        <script src="./static/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="./static/libs/metismenu/metisMenu.min.js"></script>
        <script src="./static/libs/simplebar/simplebar.min.js"></script>
        <script src="./static/libs/node-waves/waves.min.js"></script>
        <script src="./static/libs/feather-icons/feather.min.js"></script>
        <!-- pace js -->
        <script src="./static/libs/pace-js/pace.min.js"></script>

        <!-- two-step-verification js -->
        <script src="./static/js/pages/two-step-verification.init.js"></script>
        <script>
            window.onload = ()=>{
                user = JSON.parse(localStorage.getItem("user"))
                if(user){
                    document.getElementById('email').innerText = user.email
                }
                else{
                    location.href = ''
                }
                let button = document.getElementById('submit');
                console.log("hi")
                console.log(button)
                button.onclick = (e)=>{
                    e.preventDefault();
                xrh = new XMLHttpRequest();
                xrh.onload = ()=>{
                    console.log(xrh.responseText)
                    let resp = JSON.parse(xrh.responseText)
                    if(resp.success){
                        localStorage.setItem("user",JSON.stringify(resp.data))
                        if(resp.data.is_student)
                            location.href = 'timetable.html'
                        else
                            location.href = 'users.html'
                    }
                    else{
                        console.log(resp.error)
                        document.getElementById('message').innerText = resp.error;
                        document.getElementById('message-parent').style.display = "block";
                    }
                }
                xrh.open('POST','http://localhost:8000/api/auth/verify-otp');
                let otp = document.getElementById('digit1-input').value 
                + document.getElementById('digit2-input').value 
                + document.getElementById('digit3-input').value 
                + document.getElementById('digit4-input').value;
                data = {
                    email:user.email,
                    otp:otp
                }
                console.log(data)
                xrh.setRequestHeader('Content-Type','application/json')
                xrh.send(JSON.stringify(data))
            }
        }
        </script>

    </body>


</html>